import{_ as t,o as i,c as a,ag as e}from"./chunks/framework.rAhUSuuf.js";const c=JSON.parse('{"title":"身份认证相关","description":"","frontmatter":{},"headers":[],"relativePath":"api/admin/auth.md","filePath":"api/admin/auth.md","lastUpdated":null}'),n={name:"api/admin/auth.md"};function l(p,s,d,h,o,k){return i(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="身份认证相关" tabindex="-1">身份认证相关 <a class="header-anchor" href="#身份认证相关" aria-label="Permalink to &quot;身份认证相关&quot;">​</a></h1><p>管理员登录接口用于获取后续调用其他管理员接口所需的临时 Token。</p><p>除登录接口外，所有管理员接口都需要在请求头中携带 Bearer Token。</p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Authorization</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Bearer &lt;token&gt;</span></span></code></pre></div><p>Token 通过登录接口获取，有效期为 48 小时。</p><h2 id="_1-1-管理员登录" tabindex="-1">1.1 管理员登录 <a class="header-anchor" href="#_1-1-管理员登录" aria-label="Permalink to &quot;1.1 管理员登录&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>POST /admin/login</span></span></code></pre></div><p>管理员登录，获取后续调用其他管理员接口所需的临时 Token。</p><ul><li>方法：<code>POST</code></li><li>路径：<code>/admin/login</code></li><li>鉴权：不需要</li></ul><p><strong>请求头</strong></p><table tabindex="0"><thead><tr><th>名称</th><th>必填</th><th>示例</th></tr></thead><tbody><tr><td><code>Content-Type</code></td><td>是</td><td><code>application/json</code></td></tr></tbody></table><p><strong>请求体</strong></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin@example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	&quot;password&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;your_password&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>字段说明：</p><table tabindex="0"><thead><tr><th>字段名</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td><code>name</code></td><td>string</td><td>是</td><td>管理员登录名</td></tr><tr><td><code>password</code></td><td>string</td><td>是</td><td>管理员登录密码</td></tr></tbody></table><p>管理员登录名和密码由后端环境变量控制，字段为：</p><ul><li><code>ADMIN_NAME</code></li><li><code>ADMIN_PASSWORD</code></li></ul><p><strong>成功响应</strong></p><ul><li>状态码：<code>200</code></li></ul><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	&quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">		&quot;key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;f6e1e0e3-3c9b-4a24-9e88-3b1f709f1e4a&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>前端需要将 <code>data.key</code> 作为 Token 存储（例如 LocalStorage），并在后续请求中通过 <code>Authorization: Bearer &lt;key&gt;</code> 携带。</p><p><strong>错误与风控</strong></p><p>系统对登录失败进行了风控限制，防止暴力破解：</p><table tabindex="0"><thead><tr><th>参数</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td>最大失败次数</td><td>5.次</td><td>超过次数后封禁 IP</td></tr><tr><td>封禁时间</td><td>30 分钟</td><td>IP 被封禁后需等待此时间</td></tr><tr><td>计数有效期</td><td>10 分钟</td><td>失败计数在此时间后自动重置</td></tr></tbody></table><p><strong>风控逻辑</strong>：</p><ol><li>每次登录失败，系统会记录该 IP 的失败次数</li><li>失败次数在 10 分钟内连续累计</li><li>达到 5 次失败后，该 IP 被封禁 30 分钟</li><li>登录成功后会清除失败计数</li><li>所有状态存储在 Cloudflare KV 中，基于 IP 地址区分</li></ol><ul><li><p>登录失败（用户名或密码无效）：</p><ul><li>状态码：<code>401</code></li></ul><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;用户名或密码无效&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	&quot;failedAttempts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>failedAttempts</code> 字段表示当前失败次数（1-4），前端可用于提示用户剩余尝试次数。</p></li><li><p>IP 已被封禁：</p><ul><li>状态码：<code>403</code></li></ul><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;IP 已被封禁，30 分钟后重试&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>IP 被封禁后，需等待 30 分钟后自动解除，或通过管理后台手动清除 KV（删除 <code>block:&lt;IP&gt;</code> 键）。</p></li><li><p>内部错误：</p><ul><li>状态码：<code>500</code></li></ul><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">	&quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;错误信息&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li></ul>`,27)])])}const g=t(n,[["render",l]]);export{c as __pageData,g as default};
